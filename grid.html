<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Grid Planner</title>

<style>
body{
font-family:Inter,sans-serif;
background:#f3f3f3;
margin:0;
padding:30px 0;
display:flex;
justify-content:center;
}

/* CONTAINER */
.container{
width:420px;
height:720px;
background:#f8f8f8;
border-radius:24px;
border:1px solid #ddd;
box-shadow:0 6px 30px rgba(0,0,0,.08);
display:flex;
flex-direction:column;
overflow:hidden;
}

/* HEADER */
.header{
display:flex;
justify-content:space-between;
align-items:center;
padding:16px 18px;
border-bottom:1px solid #e5e5e5;
}

.refreshBtn{
background:black;
color:white;
border:none;
padding:8px 16px;
border-radius:10px;
font-weight:600;
cursor:pointer;
}

/* TABS */
.tabs{
display:flex;
justify-content:center;
gap:30px;
padding:14px 0 20px;
border-bottom:1px solid #e5e5e5;
position:relative;
}

.tabs img{
width:28px;
height:28px;
cursor:pointer;
opacity:.6;
transition:.25s;
}

.tabs img.active{
opacity:1;
transform:scale(1.1);
}

/* GLOW UNDERLINE */
.underline{
position:absolute;
bottom:6px;
height:3px;
width:40px;
background:black;
border-radius:3px;
transition:.3s;
left:0;
}

/* GRID */
.gridWrap{
flex:1;
overflow-y:auto;
}

.grid{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:6px;
padding:8px;
}

.card{
aspect-ratio:4/5;
background:#eee;
border-radius:8px;
overflow:hidden;
position:relative;
display:flex;
align-items:center;
justify-content:center;
cursor:pointer;
}

.card img,
.card video{
width:100%;
height:100%;
object-fit:cover;
position:relative;
z-index:1;
}

.noContent{
font-size:12px;
color:#777;
}

/* BADGES */
.badge{
position:absolute;
top:6px;
right:6px;
width:16px;
height:16px;
z-index:10;
}

.multiBadge{
position:absolute;
top:6px;
right:26px;
width:16px;
height:16px;
z-index:10;
}

/* LOADER */
.loader{
text-align:center;
padding:20px;
font-weight:600;
}

/* PREVIEW MODAL */
.modal{
position:fixed;
inset:0;
background:rgba(0,0,0,.85);
display:none;
align-items:center;
justify-content:center;
z-index:999;
}

.modalContent{
position:relative;
max-width:90%;
max-height:90%;
}

.modalContent img,
.modalContent video{
max-width:100%;
max-height:80vh;
border-radius:12px;
}

.modalInfo{
color:white;
margin-top:8px;
text-align:center;
}

.close{
position:absolute;
top:-40px;
right:0;
color:white;
font-size:28px;
cursor:pointer;
}
</style>
</head>

<body>

<div class="container">

<div class="header">
<button class="refreshBtn" onclick="loadPosts()">Refresh</button>
<div style="font-weight:700;">Grid Planner</div>
</div>

<div class="tabs" id="tabs">
<img id="tab-post" onclick="setFilter('Post',0)">
<img id="tab-reel" onclick="setFilter('Reels',1)">
<img id="tab-story" onclick="setFilter('Story',2)">
<img id="tab-tiktok" onclick="setFilter('Tiktok',3)">
<div class="underline" id="underline"></div>
</div>

<div class="gridWrap">
<div id="grid" class="grid"></div>
</div>

</div>

<!-- PREVIEW -->
<div class="modal" id="modal">
<div class="modalContent">
<div class="close" onclick="closeModal()">âœ•</div>
<div id="modalMedia"></div>
<div class="modalInfo" id="modalInfo"></div>
</div>
</div>

<script>
let ALL_POSTS=[];
let FILTER="Post";

/* ICON SYNC */
function updateTabs(){

tabIcon("tab-post",FILTER==="Post","post");
tabIcon("tab-reel",FILTER==="Reels","reel");
tabIcon("tab-story",FILTER==="Story","story");
tabIcon("tab-tiktok",FILTER==="Tiktok","tiktok");

document.querySelectorAll(".tabs img").forEach(i=>i.classList.remove("active"));

if(FILTER==="Post") tabActive(0);
if(FILTER==="Reels") tabActive(1);
if(FILTER==="Story") tabActive(2);
if(FILTER==="Tiktok") tabActive(3);

}

function tabIcon(id,active,name){
document.getElementById(id).src=
`/icons/${name}-${active?"dark":"light"}.png`;
}

function tabActive(index){
const tabs=document.querySelectorAll(".tabs img");
tabs[index].classList.add("active");

const underline=document.getElementById("underline");
underline.style.left=tabs[index].offsetLeft+"px";
}

/* FILTER */
function setFilter(type,index){
FILTER=type;
updateTabs();
renderGrid();
}

/* FETCH */
async function loadPosts(){

document.getElementById("grid").innerHTML=
'<div class="loader">Loading...</div>';

const res=await fetch("/api/get-posts");
ALL_POSTS=await res.json();

ALL_POSTS.sort((a,b)=>{
if(a.pinned&&!b.pinned) return -1;
if(!a.pinned&&b.pinned) return 1;
return new Date(b.publishDate||0)-new Date(a.publishDate||0);
});

updateTabs();
renderGrid();
}

/* GRID */
function renderGrid(){

const grid=document.getElementById("grid");
grid.innerHTML="";

const filtered=ALL_POSTS.filter(p=>p.type?.includes(FILTER));

const total=Math.max(filtered.length,60);

for(let i=0;i<total;i++){

const post=filtered[i];
const card=document.createElement("div");
card.className="card";

if(post&&(post.attachment||post.video)){

if(post.attachment){
const img=document.createElement("img");
img.src=post.attachment;
card.appendChild(img);
}

if(post.video){
const vid=document.createElement("video");
vid.src=post.video;
vid.controls=true;
card.appendChild(vid);
}

if(post.pinned){
const pin=document.createElement("img");
pin.src="/icons/pin.png";
pin.className="badge";
card.appendChild(pin);
}

if(post.attachment&&post.attachment.length>1){
const multi=document.createElement("img");
multi.src="/icons/multi.png";
multi.className="multiBadge";
card.appendChild(multi);
}

card.onclick=()=>openModal(post);

}else{

const no=document.createElement("div");
no.className="noContent";
no.innerText="NO CONTENT";
card.appendChild(no);

}

grid.appendChild(card);
}

}

/* MODAL */
function openModal(post){

const modal=document.getElementById("modal");
const media=document.getElementById("modalMedia");
const info=document.getElementById("modalInfo");

media.innerHTML="";

if(post.attachment){
media.innerHTML=`<img src="${post.attachment}">`;
}else if(post.video){
media.innerHTML=`<video src="${post.video}" controls autoplay></video>`;
}

info.innerHTML=`${post.name||""}<br>${post.publishDate||""}`;

modal.style.display="flex";
}

function closeModal(){
document.getElementById("modal").style.display="none";
}

loadPosts();
</script>

</body>
</html>
