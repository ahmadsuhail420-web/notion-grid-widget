<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Grid Planner</title>

<style>

/* ===== BODY ===== */
body{
font-family:Inter, sans-serif;
background:#f3f3f3;
margin:0;
padding:20px 0;
display:flex;
justify-content:center;
}

/* ===== MAIN CONTAINER ===== */
.container{
width:420px;
height:720px;
background:#fafafa;
border-radius:24px;
border:1px solid #ddd;
box-shadow:0 8px 30px rgba(0,0,0,.08);
display:flex;
flex-direction:column;
overflow:hidden;
}

/* ===== HEADER ===== */
.header{
display:flex;
justify-content:space-between;
align-items:center;
padding:16px;
border-bottom:1px solid #eee;
}

.refreshBtn{
background:black;
color:white;
border:none;
padding:8px 16px;
border-radius:10px;
font-weight:600;
cursor:pointer;
}

.spinner{
display:none;
width:16px;
height:16px;
border:2px solid #fff;
border-top:2px solid transparent;
border-radius:50%;
animation:spin 1s linear infinite;
margin-left:8px;
}

@keyframes spin{
to{ transform:rotate(360deg); }
}

/* ===== TABS ===== */
.tabs{
display:flex;
border-bottom:1px solid #eee;
padding:12px 0 6px;
}

.tabItem{
flex:1;
text-align:center;
cursor:pointer;
}

.tabItem img{
width:26px;
opacity:.55;
transition:.25s;
}

.tabItem.active img{
opacity:1;
transform:scale(1.08);
}

/* UNDERLINE PER TAB */
.tabUnderline{
height:3px;
width:26px;
background:black;
border-radius:3px;
margin:6px auto 0;
opacity:0;
transition:.25s;
}

.tabItem.active .tabUnderline{
opacity:1;
}

/* ===== GRID ===== */
.gridWrap{
flex:1;
overflow-y:auto;
}

.grid{
display:grid;
grid-template-columns:repeat(3,1fr);
}

.card{
aspect-ratio:4/5;
background:#eee;
position:relative;
display:flex;
align-items:center;
justify-content:center;
border-right:1px solid #f0f0f0;
border-bottom:1px solid #f0f0f0;
overflow:hidden;
}

.card img,.card video{
width:100%;
height:100%;
object-fit:cover;
}

/* ===== BADGES ===== */
.badge{
position:absolute;
right:6px;
width:18px;
}

.pinBadge{ top:6px; }
.multiBadge{ top:28px; }

/* ===== NO CONTENT ===== */
.noContent{
font-size:11px;
color:#777;
}

/* ===== MODAL PREVIEW ===== */
.modal{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,.7);
display:none;
align-items:center;
justify-content:center;
z-index:999;
}

.modalContent{
position:relative;
max-width:420px;
width:90%;
}

.modalContent img,.modalContent video{
width:100%;
border-radius:12px;
}

.modalInfo{
position:absolute;
bottom:0;
left:0;
right:0;
padding:16px;
background:linear-gradient(transparent,rgba(0,0,0,.8));
color:white;
font-size:14px;
}

/* ===== FOOTER ===== */
.footer{
text-align:center;
padding:10px;
font-size:13px;
color:#666;
}

</style>
</head>

<body>

<div class="container">

<!-- HEADER -->
<div class="header">
<div style="display:flex;align-items:center;">
<button class="refreshBtn" onclick="loadPosts()">Refresh</button>
<div class="spinner" id="spinner"></div>
</div>
<div style="font-weight:700;">Grid Planner</div>
</div>

<!-- TABS -->
<div class="tabs">

<div class="tabItem active" onclick="setFilter('Post',this)">
<img src="/icons/post-dark.png">
<div class="tabUnderline"></div>
</div>

<div class="tabItem" onclick="setFilter('Reels',this)">
<img src="/icons/reel-light.png">
<div class="tabUnderline"></div>
</div>

<div class="tabItem" onclick="setFilter('Story',this)">
<img src="/icons/story-light.png">
<div class="tabUnderline"></div>
</div>

<div class="tabItem" onclick="setFilter('Tiktok',this)">
<img src="/icons/tiktok-light.png">
<div class="tabUnderline"></div>
</div>

</div>

<!-- GRID -->
<div class="gridWrap">
<div id="grid" class="grid"></div>
</div>

<div class="footer">Something Organized</div>

</div>

<!-- MODAL -->
<div id="modal" class="modal" onclick="closeModal()">
<div class="modalContent" id="modalContent"></div>
</div>

<script>

/* ===== STATE ===== */
let ALL_POSTS=[];
let FILTER="Post";

/* ===== TAB SWITCH ===== */
function setFilter(type,el){

FILTER=type;

document.querySelectorAll(".tabItem")
.forEach(t=>t.classList.remove("active"));

el.classList.add("active");

updateIcons();
renderGrid();
}

/* ===== ICON SWITCH ===== */
function updateIcons(){

document.querySelectorAll(".tabItem").forEach(tab=>{
const img=tab.querySelector("img");

if(tab.classList.contains("active")){
if(img.src.includes("post")) img.src="/icons/post-dark.png";
if(img.src.includes("reel")) img.src="/icons/reel-dark.png";
if(img.src.includes("story")) img.src="/icons/story-dark.png";
if(img.src.includes("tiktok")) img.src="/icons/tiktok-dark.png";
}else{
if(img.src.includes("post")) img.src="/icons/post-light.png";
if(img.src.includes("reel")) img.src="/icons/reel-light.png";
if(img.src.includes("story")) img.src="/icons/story-light.png";
if(img.src.includes("tiktok")) img.src="/icons/tiktok-light.png";
}

});

}

/* ===== FETCH ===== */
async function loadPosts(){

document.getElementById("spinner").style.display="block";

const res=await fetch("/api/get-posts");
ALL_POSTS=await res.json();

ALL_POSTS.sort((a,b)=>{
if(a.pinned&&!b.pinned) return -1;
if(!a.pinned&&b.pinned) return 1;
return new Date(b.publishDate||0)-new Date(a.publishDate||0);
});

renderGrid();

document.getElementById("spinner").style.display="none";
}

/* ===== GRID RENDER ===== */
function renderGrid(){

const grid=document.getElementById("grid");
grid.innerHTML="";

const filtered=ALL_POSTS.filter(p=>p.type?.includes(FILTER));

const total=Math.max(filtered.length,60);

for(let i=0;i<total;i++){

const post=filtered[i];
const card=document.createElement("div");
card.className="card";

if(post&&(post.attachment||post.video)){

if(post.attachment){
const img=document.createElement("img");
img.src=post.attachment;
card.appendChild(img);
}

if(post.video){
const vid=document.createElement("video");
vid.src=post.video;
vid.controls=true;
card.appendChild(vid);
}

/* PIN BADGE */
if(post.pinned){
const pin=document.createElement("img");
pin.src="/icons/pin.png";
pin.className="badge pinBadge";
card.appendChild(pin);
}

/* MULTI BADGE */
if(post.attachment && Array.isArray(post.attachment)){
const multi=document.createElement("img");
multi.src="/icons/multi.png";
multi.className="badge multiBadge";
card.appendChild(multi);
}

card.onclick=()=>openModal(post);

}else{

const no=document.createElement("div");
no.className="noContent";
no.innerText="NO CONTENT";
card.appendChild(no);

}

grid.appendChild(card);
}

}

/* ===== MODAL ===== */
function openModal(post){

const modal=document.getElementById("modal");
const content=document.getElementById("modalContent");

content.innerHTML="";

if(post.attachment){
content.innerHTML=`
<img src="${post.attachment}">
<div class="modalInfo">
<div>${post.name||""}</div>
<div>${post.publishDate||""}</div>
</div>
`;
}

modal.style.display="flex";
}

function closeModal(){
document.getElementById("modal").style.display="none";
}

/* ===== INIT ===== */
loadPosts();

</script>

</body>
</html>
