<!DOCTYPE html>
<html>
<body>
<p style="font-size:14px;">
Paste your Notion <b>Database ID</b>.<br>
Open the database → Share → Copy link → paste here.
</p>  

<h2>Connect Database</h2>

<input id="db" placeholder="Paste Notion Database ID" />
<br><br>
<button id="save">Save Database</button>

<p id="status"></p>

<script>
  const token = new URLSearchParams(location.search).get("token");
  const status = document.getElementById("status");

  function extractDatabaseId(input) {
    const match = input.match(/[a-f0-9]{32}/i);
    return match ? match[0] : null;
  }

  document.getElementById("save").onclick = async () => {
    const raw = document.getElementById("db").value.trim();
    if (!raw) return alert("Enter Notion database ID or URL");

    const databaseId = extractDatabaseId(raw);
    if (!databaseId) {
      alert("Invalid Notion database ID or URL");
      return;
    }

    status.innerText = "Saving database…";

    try {
      const res = await fetch("/api/save-database", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token, databaseId }),
      });

      const data = await res.json();

      if (data.url) {
        status.innerHTML = `
          <strong>Done</strong><br><br>
          Embed this URL in Notion:<br>
          <a href="${data.url}" target="_blank">${data.url}</a>
        `;
      } else {
        status.innerText = data.error || "Error saving database";
      }
    } catch (e) {
      status.innerText = "Something went wrong. Try again.";
    }
  };
</script>


</body>
</html>
